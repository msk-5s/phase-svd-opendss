# **phase-svd-opendss**

**Note: Use the `base-phase-svd` branch of this repository if trying to recreate the dataset used in the [phase-svd](https://github.com/msk-5s/phase-svd) or [phase-virtual](https://github.com/msk-5s/phase-virtual) repositories.**

This repository contains the source code for generating the [phase-svd](https://www.kaggle.com/datasets/msk5sdata/phase-svd) dataset. This code will generate a synthetic dataset using the [Electric Power Research Institute's (EPRI)](https://www.epri.com/) ckt5 test feeder circuit (radial network). This dataset is composed of 35040 measurements from 1379 single-phase loads, 591 secondary distribution transformers, and 1 substation transformer sampled at 15-minute intervals over a year.

The following measurements are generated:
- Voltage magnitude and angle for each of the 1379 single-phase loads.
- Current magnitude and angle for each of the 1379 single-phase loads.
- Voltage magnitude and angle for each of the 591 single-phase secondary distribution transformers (primary and secondary sides).
- Current magnitude and angle for each of the 591 single-phase secondary distribution transformers (primary and secondary sides).
- Voltage magnitude and angle for the 1 substation transformer (primary and secondary sides).
- Current magnitude and angle for the 1 substation transformer (primary and secondary sides).

The labels will also be generated for each load containing the following:
- Name of the load in the ckt5 circuit.
- Phase that the load is connected to (A = 0, B = 1, C = 2).
- Name of the ckt5 loadshape used to synthesize the load profile for the load.
- Name of the secondary distribution transformer that the load is connected to.

These are the labels associated with each single-phase secondary distribution transformer in the circuit. They are as follows:
- The names of the loads connected to the transformer as a string separated by ";".
- The indices of the loads connected to the transformer as a string separated by ";".
- Phase that the secondary distribution transformer is connected to (A = 0, B = 1, C = 2).
- Name of the secondary distribution transformer in the ckt5 circuit.

The generated dataset will be in the [Apache Arrow Feather](https://arrow.apache.org/docs/python/feather.html) format.

## Requirements
    - Windows
    - Python 3.9+ (64-bit)
    - OpenDSS 9.6.1.1+ (64-bit)
    - See requirements.txt file for the required python packages.
    
## Running
Since the ckt5 test feeder circuit `.dss` files aren't included in this repository, they will need to be copied from your OpenDSS installation folder to the `ckt5-src/` folder. The dataset can then be generated by simply running `run.py`.

> NOTE: During the `Running simulation...` step, the OpenDSS progress bar that pops up may stop responding (as of OpenDSS 9.2.0.1). You can safely ignore this (you just won't see how far along the simulation is) as the simulation is still running. Once the simulation is done, you will have to manually close the OpenDSS progress bar.

## Converting to `.csv` (if desired)
Pandas can be used to convert a `.feather` file to a `.csv` file using the below code:
```
import pyarrow.feather

# A pandas dataframe is returned.
# We are assuming that we are in the repository's root directory.
data_df = pyarrow.feather.read_feather("data/load-voltage-magnitude.feather")

data_df.to_csv("data/load-voltage-magnitude.csv")
```
